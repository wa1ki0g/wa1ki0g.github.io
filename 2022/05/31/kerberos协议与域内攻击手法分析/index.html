<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="目录 NTLM与kerberos认证体系  本地认证 windows 网络认证 NTLM（NT LAN Manager）协议 NTLM v1与NTLM v2的差别 域认证体系-kerberos认证 PAC   白银票据与黄金票据构造分析  白银票据 黄金票据 ticket总结   NTLM_smb 中继攻击  NTLM中继 smb中继 演示   MS14-068 漏洞分析—不安全的PAC  前言">
<meta property="og:type" content="article">
<meta property="og:title" content="kerberos协议与域内攻击手法分析">
<meta property="og:url" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="Bug@Life &amp;&amp; wa1ki0g">
<meta property="og:description" content="目录 NTLM与kerberos认证体系  本地认证 windows 网络认证 NTLM（NT LAN Manager）协议 NTLM v1与NTLM v2的差别 域认证体系-kerberos认证 PAC   白银票据与黄金票据构造分析  白银票据 黄金票据 ticket总结   NTLM_smb 中继攻击  NTLM中继 smb中继 演示   MS14-068 漏洞分析—不安全的PAC  前言">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_pNMiLVCG5P.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_2piBCnbwEM.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_tZ-7ZXpelo.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_OxxMNjqbiB.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_T_WJntP3N-.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_YJwonoG15t.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_pIxrBgkdhe.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_M2s02ESCcG.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_4IQEO-sRWF.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_jD9gGwdyn1.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_1Qm2gtg7IL.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_vh51TuSuG6.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_2BYChnAGav.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_tzIelO_2S6.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_nVLXtP-0ny.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_xDrI1AZR3Z.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_-2x0LmegbY.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_AqZJkUAIyg.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_XqZqpOykiF.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_3JBNRIOWsW.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_rgaphfxW1z.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_amxMhMTNLp.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_EwVYPgfWZr.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_EgHntLIyKE.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_wKyjruacAr.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_y-8n-M0unF.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_yNaH5WW61P.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_dI3H-HJyHp.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_zxaRMTJq7r.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_HBfRfNGWLw.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_y1bFFNG5Kb.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_o3rNOIXIhM.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_ci18baWyeb.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_vIDeBxIvFV.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_C01xJRtxUn.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_I5_CN-awPD.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_FD7nH_kXHX.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_KsX822KcBh.png">
<meta property="og:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_A5ekCATiBr.png">
<meta property="article:published_time" content="2022-05-31T11:38:52.000Z">
<meta property="article:modified_time" content="2025-07-31T15:02:58.690Z">
<meta property="article:author" content="wa1ki0g">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_pNMiLVCG5P.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>kerberos协议与域内攻击手法分析</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2022/08/06/Hashdump-bypass-LSA-%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2021/03/21/shiro%E5%8E%9F%E7%94%9FCB%E9%93%BE%E4%B8%8E%E5%B8%B8%E8%A7%81CC-gadget%E5%88%86%E6%9E%90/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&text=kerberos协议与域内攻击手法分析"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&title=kerberos协议与域内攻击手法分析"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&is_video=false&description=kerberos协议与域内攻击手法分析"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=kerberos协议与域内攻击手法分析&body=Check out this article: http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&title=kerberos协议与域内攻击手法分析"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&title=kerberos协议与域内攻击手法分析"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&title=kerberos协议与域内攻击手法分析"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&title=kerberos协议与域内攻击手法分析"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&name=kerberos协议与域内攻击手法分析&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&t=kerberos协议与域内攻击手法分析"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NTLM%E4%B8%8Ekerberos%E8%AE%A4%E8%AF%81%E4%BD%93%E7%B3%BB"><span class="toc-number">2.</span> <span class="toc-text">NTLM与kerberos认证体系</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E8%AE%A4%E8%AF%81"><span class="toc-number">2.1.</span> <span class="toc-text">本地认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#windows-%E7%BD%91%E7%BB%9C%E8%AE%A4%E8%AF%81"><span class="toc-number">2.2.</span> <span class="toc-text">windows 网络认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM%EF%BC%88NT-LAN-Manager%EF%BC%89%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.3.</span> <span class="toc-text">NTLM（NT LAN Manager）协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM-v1%E4%B8%8ENTLM-v2%E7%9A%84%E5%B7%AE%E5%88%AB"><span class="toc-number">2.4.</span> <span class="toc-text">NTLM v1与NTLM v2的差别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E8%AE%A4%E8%AF%81%E4%BD%93%E7%B3%BB-kerberos%E8%AE%A4%E8%AF%81"><span class="toc-number">2.5.</span> <span class="toc-text">域认证体系-kerberos认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PAC"><span class="toc-number">2.6.</span> <span class="toc-text">PAC</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE%E4%B8%8E%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE%E6%9E%84%E9%80%A0%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">白银票据与黄金票据构造分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE"><span class="toc-number">3.1.</span> <span class="toc-text">白银票据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE"><span class="toc-number">3.2.</span> <span class="toc-text">黄金票据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ticket%E6%80%BB%E7%BB%93"><span class="toc-number">3.3.</span> <span class="toc-text">ticket总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NTLM-smb-%E4%B8%AD%E7%BB%A7%E6%94%BB%E5%87%BB"><span class="toc-number">4.</span> <span class="toc-text">NTLM_smb 中继攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM%E4%B8%AD%E7%BB%A7"><span class="toc-number">4.1.</span> <span class="toc-text">NTLM中继</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#smb%E4%B8%AD%E7%BB%A7"><span class="toc-number">4.2.</span> <span class="toc-text">smb中继</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%94%E7%A4%BA"><span class="toc-number">4.3.</span> <span class="toc-text">演示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MS14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E2%80%94%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84PAC"><span class="toc-number">5.</span> <span class="toc-text">MS14-068 漏洞分析—不安全的PAC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">5.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E5%9B%A0%E7%AE%80%E8%BF%B0"><span class="toc-number">5.2.</span> <span class="toc-text">漏洞原因简述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E5%8E%9F%E5%9B%A0"><span class="toc-number">5.3.</span> <span class="toc-text">详细原因</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%BC%94%E7%A4%BA"><span class="toc-number">5.4.</span> <span class="toc-text">漏洞演示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#zerologon%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">6.</span> <span class="toc-text">zerologon漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E5%9B%A0"><span class="toc-number">6.1.</span> <span class="toc-text">漏洞原因</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DCSync"><span class="toc-number">6.2.</span> <span class="toc-text">DCSync</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DCSync%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">6.3.</span> <span class="toc-text">DCSync利用条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">6.4.</span> <span class="toc-text">漏洞利用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Nopac%E5%88%86%E6%9E%90"><span class="toc-number">7.</span> <span class="toc-text">Nopac分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PrintNightmare%E5%88%86%E6%9E%90"><span class="toc-number">8.</span> <span class="toc-text">PrintNightmare分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CVE-2025-33073%E5%88%86%E6%9E%90"><span class="toc-number">9.</span> <span class="toc-text">CVE-2025-33073分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#EXCHANGE"><span class="toc-number">10.</span> <span class="toc-text">EXCHANGE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ADCS"><span class="toc-number">11.</span> <span class="toc-text">ADCS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ACL%E6%BB%A5%E7%94%A8"><span class="toc-number">12.</span> <span class="toc-text">ACL滥用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A7%94%E6%B4%BE%E6%94%BB%E5%87%BB%E4%B8%93%E9%A1%B9"><span class="toc-number">13.</span> <span class="toc-text">委派攻击专项</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Azure-AD"><span class="toc-number">14.</span> <span class="toc-text">Azure-AD</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kerberoasting-AS-REP-Roasting"><span class="toc-number">15.</span> <span class="toc-text">Kerberoasting&#x2F;AS-REP Roasting</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        kerberos协议与域内攻击手法分析
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">wa1ki0g</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-05-31T11:38:52.000Z" class="dt-published" itemprop="datePublished">2022-05-31</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/red-team/">red-team</a>
    </div>


      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul>
<li><p><a href="#NTLM%E4%B8%8Ekerberos%E8%AE%A4%E8%AF%81%E4%BD%93%E7%B3%BB">NTLM与kerberos认证体系</a></p>
<ul>
<li><a href="#%E6%9C%AC%E5%9C%B0%E8%AE%A4%E8%AF%81">本地认证</a></li>
<li><a href="#windows-%E7%BD%91%E7%BB%9C%E8%AE%A4%E8%AF%81">windows 网络认证</a></li>
<li><a href="#NTLMNT-LAN-Manager%E5%8D%8F%E8%AE%AE">NTLM（NT LAN Manager）协议</a></li>
<li><a href="#NTLM-v1%E4%B8%8ENTLM-v2%E7%9A%84%E5%B7%AE%E5%88%AB">NTLM v1与NTLM v2的差别</a></li>
<li><a href="#%E5%9F%9F%E8%AE%A4%E8%AF%81%E4%BD%93%E7%B3%BB-kerberos%E8%AE%A4%E8%AF%81">域认证体系-kerberos认证</a></li>
<li><a href="#PAC">PAC</a></li>
</ul>
</li>
<li><p><a href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE%E4%B8%8E%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE%E6%9E%84%E9%80%A0%E5%88%86%E6%9E%90">白银票据与黄金票据构造分析</a></p>
<ul>
<li><a href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE">白银票据</a></li>
<li><a href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE">黄金票据</a></li>
<li><a href="#ticket%E6%80%BB%E7%BB%93">ticket总结</a></li>
</ul>
</li>
<li><p><a href="#NTLM_smb-%E4%B8%AD%E7%BB%A7%E6%94%BB%E5%87%BB">NTLM_smb 中继攻击</a></p>
<ul>
<li><a href="#NTLM%E4%B8%AD%E7%BB%A7">NTLM中继</a></li>
<li><a href="#smb%E4%B8%AD%E7%BB%A7">smb中继</a></li>
<li><a href="#%E6%BC%94%E7%A4%BA">演示</a></li>
</ul>
</li>
<li><p><a href="#MS14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84PAC">MS14-068 漏洞分析—不安全的PAC</a></p>
<ul>
<li><a href="#%E5%89%8D%E8%A8%80">前言</a></li>
<li><a href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E5%9B%A0%E7%AE%80%E8%BF%B0">漏洞原因简述</a></li>
<li><a href="#%E8%AF%A6%E7%BB%86%E5%8E%9F%E5%9B%A0">详细原因</a></li>
<li><a href="#%E6%BC%8F%E6%B4%9E%E6%BC%94%E7%A4%BA">漏洞演示</a></li>
</ul>
</li>
<li><p><a href="#zerologon%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90">zerologon漏洞分析</a></p>
<ul>
<li><a href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E5%9B%A0">漏洞原因</a></li>
<li><a href="#DCSync">DCSync</a></li>
<li><a href="#DCSync%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6">DCSync利用条件</a></li>
<li><a href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">漏洞利用</a></li>
</ul>
</li>
<li><p><a href="#Nopac%E5%88%86%E6%9E%90">Nopac分析</a></p>
</li>
<li><p><a href="#PrintNightmare%E5%88%86%E6%9E%90">PrintNightmare分析</a></p>
</li>
<li><p><a href="#CVE-2025-33073%E5%88%86%E6%9E%90">CVE-2025-33073分析</a></p>
</li>
<li><p><a href="#EXCHANGE">EXCHANGE</a></p>
</li>
<li><p><a href="#ADCS">ADCS</a></p>
</li>
<li><p><a href="#ACL%E6%BB%A5%E7%94%A8">ACL滥用</a></p>
</li>
<li><p><a href="#%E5%A7%94%E6%B4%BE%E6%94%BB%E5%87%BB%E4%B8%93%E9%A1%B9">委派攻击专项</a></p>
</li>
<li><p><a href="#Azure-AD">Azure-AD</a></p>
</li>
<li><p><a href="#ACL%E6%BB%A5%E7%94%A8">Kerberoasting&#x2F;AS-REP Roasting</a></p>
</li>
</ul>
<p>随缘更，随缘补，与时俱进</p>
<h1 id="NTLM与kerberos认证体系"><a href="#NTLM与kerberos认证体系" class="headerlink" title="NTLM与kerberos认证体系"></a>NTLM与kerberos认证体系</h1><h2 id="本地认证"><a href="#本地认证" class="headerlink" title="本地认证"></a>本地认证</h2><p>本地认证是今天讲的这些认证方式之中最简单的一个。</p>
<p>当我们开机登录输入密码的时候，系统会将我们输入的明文密码加密成NTLM hash，此时再同sam文件里的值进行对比，如果相同，则登录成功。NTLM hash的前身是LM hash</p>
<p>SAM文件中所储存的是密码的hash值</p>
<p>我们上面说的sam文件是指：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">C</span>:\<span class="title class_">Windows</span>\<span class="title class_">System32</span>\config\<span class="variable constant_">SAM</span></span><br></pre></td></tr></table></figure>

<p>总结一下，就是用户注销、重启后，操作系统会显示输入框，接收输入后，首先判断输入的用户名是否存在，如果存在将密码交给lsass进程，这个进程中可能会存一份明文密码，将明文密码加密成NTLM Hash，对比SAM数据库中的hash进行验证。</p>
<p>NTLM hash 的产生：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">明文-&gt;hex编码-&gt;<span class="title class_">Unicode</span>编码-&gt;<span class="title class_">MD4</span></span><br></pre></td></tr></table></figure>

<p>python实现：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_pNMiLVCG5P.png"></p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_2piBCnbwEM.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib,binascii</span><br><span class="line"><span class="built_in">hash</span> = hashlib.new(<span class="string">&#x27;md4&#x27;</span>, <span class="string">&quot;password&quot;</span>.encode(<span class="string">&#x27;utf-16le&#x27;</span>)).digest()</span><br><span class="line"><span class="built_in">print</span> binascii.hexlify(<span class="built_in">hash</span>)</span><br></pre></td></tr></table></figure>

<p>或者也可以直接用ntlm库</p>
<h2 id="windows-网络认证"><a href="#windows-网络认证" class="headerlink" title="windows 网络认证"></a>windows 网络认证</h2><ul>
<li>在内网渗透中，经常会遇到工作组环境，而工作组环境是一个逻辑上的网络环境（局域网工作区），因为在工作组中并不存在一个信托机构，所以隶属于工作组的机器之间是无法建立一个完美的信任机制的，只能点对点进行认证</li>
<li>假如在一个工作组中有a，b两个机器，a想远程访问b上的文件，那么这个时候a机器的操纵者则需要将一个存在于b机器上的账户凭证发送给b机器，经过认证后才能访问。</li>
<li>最常见的服务：445端口的smb服务</li>
<li>smb协议：一个用于进行共享文件资源的一个协议</li>
</ul>
<h2 id="NTLM（NT-LAN-Manager）协议"><a href="#NTLM（NT-LAN-Manager）协议" class="headerlink" title="NTLM（NT LAN Manager）协议"></a>NTLM（NT LAN Manager）协议</h2><ul>
<li>早期smb协议在网络上传输明文口令，后来出现LAN Manager Challenge&#x2F;Response 验证机制，简称LM，由于他的不安全性，微软在后面的更新中提出了windowsNT挑战&#x2F;响应验证机制，称之为NTLM。发展到现在已经有了更新的NTLM V2以及Kerberos验证体系。</li>
<li>smb协议本身只提供了资源相关的共享服务，在认证方面，采用的是NTLM协议，可以类比我们远程访问windows的共享文件夹时，在认证我们身份的方面，也是采用的NTLM协议，在windows的好多服务的”认证层”上，使用的都是我们的NTLM协议。当然如果是在域内，认证方面会采用kerberos协议进行认证</li>
</ul>
<p><strong>挑战（challenge）&#x2F;响应（response）机制</strong></p>
<p>主要分为质询-&gt;协商-&gt;验证三个阶段</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_tZ-7ZXpelo.png"></p>
<p><strong>第一步协商</strong></p>
<p>简单来说就是客户端主要在这一步向服务端确认协议的版本，是NTLM v1还是NTLM v2还是其他的比如LM协议。</p>
<p><strong>第二步质询</strong></p>
<p>第二步质询完整过程：</p>
<ol>
<li>客户端向服务端发送用户信息（包含用户名）请求</li>
<li>服务器接受到请求，生成一个16位的随机数，被称之为”challenge”，并在本机sam文件上查找登录名对应的密码的NTLM Hash，并用这个NTLM Hash 加密challenge，生成challenge1后，将challenge发送回客户端（<strong>这里的challenge1呢其实就叫做Net NTLM Hash，这个在ntlm中继攻击中提到过，可以去看下那篇文章）</strong></li>
<li>客户端接受到challenge后，会将用户输入的密码进行NTLM hash，并使用NTLM hash加密 challenge, 生成Response，然后将Response发送至服务端。<strong>（这里的Response，本质上也可以说是Net NTLM Hash）</strong></li>
<li>服务器端收到客户端的Response后，对比challenge与Response是否相等，若相等，则认证通过</li>
</ol>
<p><strong>第三步验证</strong></p>
<p>这一步其实就是上面质询过程中的第4点，为了更方便理解，所以没有拆分</p>
<p><strong>总结</strong></p>
<p>这里有一个总结的图示：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_OxxMNjqbiB.png"></p>
<h2 id="NTLM-v1与NTLM-v2的差别"><a href="#NTLM-v1与NTLM-v2的差别" class="headerlink" title="NTLM v1与NTLM v2的差别"></a>NTLM v1与NTLM v2的差别</h2><ul>
<li>NTLM v1与NTLM v2最大的差别就是challenge与加密算法不同</li>
<li>challenge:NTLM v1的challenge有8位，NTLM v2的challenge有16位</li>
<li>Net-NTLM hash:NTLM v1的主要加密算法是DES,NTLM v2的主要加密算法是HMAC-MD5</li>
</ul>
<h2 id="域认证体系-kerberos认证"><a href="#域认证体系-kerberos认证" class="headerlink" title="域认证体系-kerberos认证"></a>域认证体系-kerberos认证</h2><p><strong>（注：下面所有流程图中的ticket代表ST）</strong></p>
<ul>
<li>kerbroes是一种网络认证协议，其目标设计是通过密钥系统为客户机&#x2F;服务器应用程序提供强大的认证服务。该认证过程的实现不依赖于主机操作系统的认证，无需基于主机地址的信任，不要求网络上所有主机的物理安全，并假定网络上传送的数据包，可以被任意的读取修改。在以上情况下，kerberos作为一种可信任的第三方服务，是通过传统的密码技术（如共享密钥），执行认证服务的</li>
</ul>
<p><strong>域认证所参与的三个角色</strong></p>
<ul>
<li>client（客户端）</li>
<li>server（服务端）</li>
<li>KDC（域控上的一个服务）</li>
</ul>
<p><strong>域认证所参与的角色（KDC上又细分的一些服务）</strong></p>
<ul>
<li>AD(account database)：储存所有client的白名单，只有存在于白名单的client才能顺利申请到TGT</li>
<li>AS（Authentication Service）:为client生成TGT的服务</li>
<li>TGS(Ticket Granting Service)：为client生成某个服务的ticket。生成ST的地方</li>
</ul>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_T_WJntP3N-.png"></p>
<p><strong>域认证流程——粗略流程</strong></p>
<ol>
<li>client向kerberos服务（就是我们的域控上的一个服务）请求，希望获得访问server的权限。kerberos服务得到了这个消息，首先判断client是否是可信赖的（就是判断是否是此域内的机器），也就是白名单黑名单的说法。这就是AS服务完成的工作，通过在AD中存储黑名单和白名单来区分client。成功后AS返回TGT给客户端。(AS_REQ与AS_REP)</li>
<li>client得到TGT后，继续向kerberos服务请求，希望获得访问server的权限。kerberos服务得到了这个消息，这时通过client消息中的TGT，判断出了client拥有这个权限，于是给了client访问服务端的权限并返回了ST。(TGS_REQ与TGS_REP)</li>
<li>client得到ST后，终于可以访问server。这个ST只是针对这个server，其他server需要向TGS申请。(AP_REQ与AP_REP)</li>
</ol>
<p><strong>域认证流程深入剖析—第一步：TGT的获取 (AS_REQ与AS_REP)</strong></p>
<ol>
<li>首先我们的客户端会向域控上的kdc服务的AS发送我们客户端的一些信息，比如用户名，主机名等。</li>
<li>下一步我们的kdc服务上的AS就会进行判断这个主机、用户名等是否在我们的域里面，如果存在，那么我们kdc上的AS就会生成一个session key，这个session key是一串随机字符。</li>
<li>域用户的密码的NTLM hash是可以域控上查到的，然后就会使用这个客户端用户对应的NTLM hash来加密我们的session key，并将加密后的值返回发送给客户端。</li>
<li>然后域控这里下一步会使用KDC服务对应的用户的NTLM hash，对session key和一些客户端的信息再进行加密，最后加密出的结果也就是我们常说的TGT，并将他连同3中加密出的值一同返回发送给客户端</li>
</ol>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_YJwonoG15t.png"></p>
<p>我们再来用两张图详细的剖析下上面所说的”客户端发送”与”KDC返回”这样的两个过程：</p>
<p>发送：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_pIxrBgkdhe.png"></p>
<p>返回：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_M2s02ESCcG.png"></p>
<p>大家可以看到这里的TGT的有效性是有时间限制的</p>
<p><strong>域认证流程深入剖析—第二步：获取ST (TGS_REQ与TGS_REP)</strong></p>
<ol>
<li>我们的客户端接收到了一个密文和一个TGT</li>
<li>第一个密文是KDC用我们客户端的用户的密码的NTLM hash加密session key产生的，因为这个客户端的用户的密码的NTLM hash不仅在域控上存在，在我们客户端本机也是存在的，所以的客户端就会使用这个客户端的用户的密码的NTLM hash来对密文进行解密，从而得到session key。</li>
<li>下一步我们的客户端就会向KDC上的TGS服务发送TGT，以及用session key加密的当前客户端的一些信息和时间戳，然后还有一些客户端的信息和要访问的服务端的信息这三块内容</li>
<li>当我们客户端向KDC发送以后，KDC的TGS服务就会开始进行认证，它首先会使用KDC服务对应的用户的NTLM hash去解密TGT得到session key，再通过session key去解密客户端包装加密的信息，得到客户端的一些信息和时间戳，然后会比较这个时间戳和当前的时间戳是不是间隔的太久了，如果间隔超过一定时间则需要他重新从头开始验证，然后他还会通过接收到的这个客户端的信息和服务端的信息来判断当前客户端是否有权限去访问这个服务端</li>
<li>当KDC上的TGS认证通过以后呢，他又会随机生成一串字符，叫做server session key，这个server session key其实就是用于客户端和服务端进行通信时的密钥。然后TGS会使用session key来加密这个server session key并将这个密文返回给客户端。</li>
<li>TGS还会提取客户端的所在的域的域名，客户端的用户信息，server session key,到期时间等，来做成ST</li>
<li>此时TGS还会提取接收到的要访问的服务端的一些信息，并使用服务器端对应的计算机名对应的NTLM hash来加密ST，并将这个密文也返回给客户端</li>
</ol>
<p>流程图：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_4IQEO-sRWF.png"></p>
<p>ST的组成：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_jD9gGwdyn1.png"></p>
<p><strong>域认证流程深入剖析—第三步：client通过ST访问server (AP_REQ与AP_REP)</strong></p>
<ol>
<li>客户端通过session key解密得到server session key，并使用server session key来加密客户端的信息和时间戳，并连同ST一同发给服务端</li>
<li>因为服务端这台机器上是存着自己的用户hash的，所以我们可以使用Server hash解密得到ST，并得到ST里的end time，用他来判断得到ST是否已经过期，还会得到ST里的server session key，然后会使用这个server session key来解密1步骤的密文，得到客户端的信息和时间戳，然后他会去校验这个客户端信息和ticket里的客户端信息是否相等，还会验证这个时间戳是否大于某个时间。</li>
</ol>
<p>简易流程图：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_1Qm2gtg7IL.png"></p>
<h2 id="PAC"><a href="#PAC" class="headerlink" title="PAC"></a>PAC</h2><p>在黄金&#x2F;白银票据的构造分析中，开启PAC可以防止白银票据的攻击。</p>
<p><strong>那么PAC是什么呢？</strong></p>
<p>我们都知道黄金票价的构造原理就是：掌握KRBTGT用户密码之后可以通过签发一张高权限用户的TGT票据，再利用这个TGT向KDC获取域内服务的ticket来实现对域的控制。那么这里的“高权限用户”是通过什么来判断的呢，答案就是PAC。</p>
<p><strong>PAC在我们域认证中出现的节点是在哪的呢？</strong></p>
<p>主要是两个节点</p>
<ol>
<li>当我们的客户端第一次向KDC去请求TGT的时候，我们返回的TGT票据中就包含了PAC。(AS_REP)</li>
<li>就是最后我们的客户端拿着ST去与服务端通信的时候，如果一切验证顺利，那么最后我们的服务端就会将解密出来的PAC发送给KDC去进行认证，KDC解密PAC。获取Client的sid，以及所在的组，再根据该服务的ACL，判断Client是否有访问服务的权限。防止白银票据其实主要也是这一步。 (AP_REP)</li>
</ol>
<p><strong>总结</strong><br>kerberos认证流程的本质上就是不停交换密钥，然后采用对称加密算法验证时间戳和身份，来完成的一个安全认证</p>
<h1 id="白银票据与黄金票据构造分析"><a href="#白银票据与黄金票据构造分析" class="headerlink" title="白银票据与黄金票据构造分析"></a>白银票据与黄金票据构造分析</h1><p><strong>（下面所说的Server hash指的是服务端机器用户的NTLM hash）****我们的白银票据和黄金票据主要是用来做权限维持的</strong></p>
<h2 id="白银票据"><a href="#白银票据" class="headerlink" title="白银票据"></a>白银票据</h2><p><strong>白银票据的特点：</strong></p>
<ol>
<li>不需要与DKC进行交互</li>
<li>需要服务端的计算机机器账户ntlm hash</li>
<li>只能针对一台机器</li>
</ol>
<p>在我们那个认证协议分析的文章中介绍了整个基于kerberos协议认证的流程，其中说到了ST，而我们所说的白银票据其实就是我们伪造的ST。</p>
<p>在上面也讲了，ST的构成： &#x20;<br>ticket&#x3D;Server hash（Server session key+Client info+End Time）</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_vh51TuSuG6.png"></p>
<p>根据我们讲协议那篇文章可知，当客户端与服务端进程认证时，客户端会使用server session key来加密客户端的信息和时间戳，并连同ST一同发给服务端，然后服务端会使用Server hash解密ST，得到ST里的end time，server session key等，所以在未发送ST之前，服务端是不知道Server Session Key是什么的，所以我们只要知道Server hash就可以伪造一个不经过KDC认证的ST，这也就是我们白银票据的原理。</p>
<p>在构造的时候，我们可以自定义一个Server session key并使用它加密客户端的信息和时间戳并伪造一个ST一同发送给服务端。</p>
<p><strong>白银票据-mimikatz伪造演示</strong></p>
<p>导出Server hash：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;privilege::debug&quot; &quot;sekurlsa::logonpasswords&quot; &quot;exit&quot; &gt; log.txt</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_2BYChnAGav.png"></p>
<p><strong>伪造票据：</strong></p>
<p>在另外的机器上执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe &quot;kerberos::golden /domain:&lt;域名&gt; /sid:&lt;域SID&gt; /target:&lt;目标服务器主机名&gt; /service:&lt;服务类型&gt; /rc4:&lt;NTLM Hash&gt; /user:&lt;用户名&gt; /ptt&quot; exit</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/domain：域名</span><br><span class="line">/sid：SID值</span><br><span class="line">/target: 服务端计算机名</span><br><span class="line">/service: 需要指定相关的服务名</span><br><span class="line">/rc4: 服务端的计算机机器账户ntlm hash</span><br><span class="line">/user: 要伪造的用户名，任意填写</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_tzIelO_2S6.png"></p>
<p><strong>成功：</strong></p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_nVLXtP-0ny.png"></p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_xDrI1AZR3Z.png"></p>
<p><strong>补充：</strong></p>
<p>因为ST 生成时指定了相关的服务名，所以因此只能用来访问相对应的服务。还有一些其他的服务：</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">服务名称                              同时需要的服务</span><br><span class="line">WMI                                  HOST、RPCSS</span><br><span class="line">PowerShell Remoting                  HOST、HTTP</span><br><span class="line">WinRM                                HOST、HTTP</span><br><span class="line">Scheduled Tasks                      HOST</span><br><span class="line">Windows File Share                   CIFS</span><br><span class="line">LDAP                                 LDAP</span><br><span class="line">Windows Remote Server                RPCSS、LDAP、CIFS</span><br></pre></td></tr></table></figure>

<p><strong>白银票据防御</strong><br>开启PAC</p>
<h2 id="黄金票据"><a href="#黄金票据" class="headerlink" title="黄金票据"></a>黄金票据</h2><p>黄金票据特点：</p>
<ol>
<li>需要与DC通信</li>
<li>需要krbtgt用户的hash</li>
</ol>
<p>这里的krbtgt用户的hash指的就是上面的KDC Hash：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_-2x0LmegbY.png"></p>
<p>黄金票据实际上指的就是我们伪造的那些TGT，在我们知道KDC Hash以后，就可以利用构造出来的TGT去申请各种服务的，拿到ST以后就可以访问目标服务器。</p>
<p>我们在讲协议认证的那篇博客中，讲了TGT的构成：使用KDC hash 加密(session key ，客户端信息，客户端到期时间）后的密文</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_AqZJkUAIyg.png"></p>
<ul>
<li>在我们上篇文章讲到了，在获取ST的时候，客户端会拿着得到的TGT以及用session key加密的当前客户端的一些信息和时间戳，然后还有一些客户端的信息和要访问的服务端的信息这三块内容去获取ST。</li>
<li>然后在服务端接受后它首先会使用KDC服务对应的用户的NTLM hash去解密TGT得到session key，再通过session key去解密客户端包装加密的信息，得到客户端的一些信息和时间戳，然后会比较这个时间戳和当前的时间戳是不是间隔的太久了，如果间隔超过一定时间则需要他重新从头开始验证，然后他还会通过接收到的这个客户端的信息和服务端的信息来判断当前客户端是否有权限去访问这个服务端。</li>
</ul>
<p><strong>所以黄金票据的原理就是伪造获取ST时发送的TGT和用session key加密的密文等”，而这些在我们知道KDC Hash以后，是都可以完成的，伪造成功以后通过DC的认证拿到ST就可以访问目标服务器。（伪造的时候，session key 我们自己定义一串字符就好）</strong></p>
<p><strong>伪造票据：</strong></p>
<p>抓取域内hash：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">域控执行：lsadump::lsa /patch</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_XqZqpOykiF.png"></p>
<p>在另外的机器上执行：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz.exe <span class="string">&quot;kerberos::golden /domain:&lt;域名&gt; /sid:&lt;域SID&gt; /rc4:&lt;KRBTGT NTLM Hash&gt; /user:&lt;用户名&gt; /ptt&quot;</span> <span class="keyword">exit</span></span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/domain：域名</span><br><span class="line">/sid：SID值</span><br><span class="line">/rc4: 域控的krbtgt账户ntlm hash</span><br><span class="line">/user: 要伪造的用户名，任意填写</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_3JBNRIOWsW.png"></p>
<p>成功：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_rgaphfxW1z.png"></p>
<h2 id="ticket总结"><a href="#ticket总结" class="headerlink" title="ticket总结"></a>ticket总结</h2><p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_amxMhMTNLp.png"></p>
<h1 id="NTLM-smb-中继攻击"><a href="#NTLM-smb-中继攻击" class="headerlink" title="NTLM_smb 中继攻击"></a>NTLM_smb 中继攻击</h1><h2 id="NTLM中继"><a href="#NTLM中继" class="headerlink" title="NTLM中继"></a>NTLM中继</h2><p>其实简单来说，ntlm中继攻击就是一种中间人攻击</p>
<p><strong>Windows系统域名解析顺序</strong></p>
<ol>
<li>本地hosts文件（%Systemroot%\System32\drivers\etc\hosts）</li>
<li>DNS缓存&#x2F;DNS服务器</li>
<li>链路本地多播名称解析（LLMNR）和NetBIOS名称服务（NBNS）</li>
</ol>
<p>当1，2步请求失败时，Windows系统就会通过LLMNR和NetBIOS名称服务在本地进行名称解析。这时，客户端就会将未经认证的UDP广播到网络中，询问它是否为本地系统的名称。这时我们监听网段的请求，就可以对信息进行捕捉，我们可以监听到的大多都是Net-NTLM hash，他并不是我们明文的直接hash值，所以我们不可以利用它直接进行横向攻击。</p>
<h2 id="smb中继"><a href="#smb中继" class="headerlink" title="smb中继"></a>smb中继</h2><p><strong>smb中继攻击是基于ntml中继攻击的一种，因为SMB的认证是可以基于NTLM协议或者kerberos协议</strong></p>
<p><strong>对于SMB协议，客户端在连接服务端时，默认先使用本机的用户名和密码hash尝试登录，所以可以模拟SMB服务器从而截获Net-NTLM hash，进行破解明文，或进行中继</strong></p>
<h2 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h2><p>环境： &#x20;<br>kali：10.10.10.160 &#x20;<br>域控：10.10.10.10 &#x20;<br>pc1：10.10.10.201 &#x20;<br>pc2：10.10.10.80</p>
<p><strong>利用LLMNR和NetBIOS截取Net-NTLM Hash</strong></p>
<p>使用responder监听同域内中所有主机的广播请求：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_EwVYPgfWZr.png"></p>
<p>pc1上输入个错误的地址，让其通过LLMNR和NetBIOS进行名称解析：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_EgHntLIyKE.png"></p>
<p>得到hash：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_wKyjruacAr.png"></p>
<p><strong>利用smb 中继进行攻击</strong></p>
<blockquote>
<p>再说smb攻击之前，先介绍一下SMB签名 &#x20;<br>SMB签名是一种服务器与客户端协商以使用继承的会话密钥对所有传入的数据包进行数字签名的配置。这样的话，即使NTLM会话还是可能被Relay，服务器也不会被利用，因为攻击者缺少会话密钥。在Active &#x20;<br>Directory 网络中只有域名控制器默认开启SMB签名，其他的所有服务器或工作组默认不受保护。所以只有被攻击的目标机器SMB签名关闭的时候，才会攻击成功</p>
</blockquote>
<p>探测一波，可以看到与前面说的比较符合，只有域控默认会开启smb签名：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_y-8n-M0unF.png"></p>
<p>可以关掉：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add HKLM\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters /v RequireSecuritySignature /t REG_DWORD /d 0 /f</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_yNaH5WW61P.png"></p>
<p><strong>利用responder+MultiRelay.py获取shell：</strong></p>
<p>修改下Responder.conf ：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_dI3H-HJyHp.png"></p>
<p><a target="_blank" rel="noopener" href="http://开启responder与multirelay.py/" title="开启responder与MultiRelay.py">开启responder与MultiRelay.py</a>，填好要攻击的目标pc2的ip：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_zxaRMTJq7r.png"></p>
<p>其他机器上随便传一个smb流量：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_HBfRfNGWLw.png"></p>
<p>攻击成功：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_y1bFFNG5Kb.png"></p>
<p><strong>利用 <strong><a target="_blank" rel="noopener" href="http://smbrelayx.py/" title="smbrelayx.py"><strong>smbrelayx.py</strong></a></strong> 获取shell：</strong></p>
<p>原理： 伪造一个我们恶意的SMB服务器，当内网中有机器访问这个我们精心构造好的SMB服务器时， <a target="_blank" rel="noopener" href="http://smbrelayx.py/" title="smbrelayx.py">smbrelayx.py</a> 将抓到Client1 的 hash ，然后 <a target="_blank" rel="noopener" href="http://smbrelayx.py/" title="smbrelayx.py">smbrelayx.py</a> 用抓取到的 Client1 的 hash 重 放给 Client2</p>
<p><strong>指定要攻击的机器ip：</strong></p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_o3rNOIXIhM.png"></p>
<p><strong>在其他机器上传一个smb的流量：</strong></p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_ci18baWyeb.png"></p>
<p><strong>命令执行成功：</strong></p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_vIDeBxIvFV.png"></p>
<h1 id="MS14-068-漏洞分析—不安全的PAC"><a href="#MS14-068-漏洞分析—不安全的PAC" class="headerlink" title="MS14-068 漏洞分析—不安全的PAC"></a>MS14-068 漏洞分析—不安全的PAC</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><strong>这是一个危害较高的漏洞：只需要一个域内的普通用户的账户密码，便可拿到域控的权限</strong></p>
<h2 id="漏洞原因简述"><a href="#漏洞原因简述" class="headerlink" title="漏洞原因简述"></a>漏洞原因简述</h2><p>**利用伪造的高权限的PAC来获取一个带有高权限PAC的TGT。<br>**<strong>(关于pac是什么上面也已经解释过了)</strong></p>
<blockquote>
<p>在我们的AS_REQ 请求中如果include-pac被置为 true，那么我们的 AS 会在返回的 TGT 中加入 PAC信息，如果我们在 AS_REQ 数据包中，将include-pac被置为 false，那么 AS_REP 返回的 TGT 中就不会包含 PAC &#x20;<br>信息。在TGT中没有PAC信息后，我们就可以使用域用户去伪造”恶意”的PAC放入TGS_REQ中，KDC解密PAC后会再次加密到一个新的TGT中并返回给域用户(注意这里KDC返回的是一个TGT并不是一个ticket)，此时的TGT中已经携带了“恶意”PAC，也就达到漏洞利用的目的。</p>
</blockquote>
<h2 id="详细原因"><a href="#详细原因" class="headerlink" title="详细原因"></a>详细原因</h2><ol>
<li>KDC机构对PAC进行验证时，对于PAC尾部的签名算法，理上规定必须是带有Key的签名算法才可以，但实际上却允许任意签名算法，所以只要我们客户端去随便指定一个方便验证通过的签名算法，那么KDC服务器就会使用我们指定的算法来进行签名验证。比如说我们可以规定使用md5算法，将 md5(内容) 来作为签名，这样当KDC接收以后，发现我们在数据包中规定了使用md5算法，那么KDC就会将我们的内容进行md5后与我们的签名进行比对。如此一来我们可以对内容进行伪装。‘</li>
<li>PAC没有被放在TGT中，而是放在了TGS_REQ数据包的其它地方。但KDC还是能够正确解析出放在其它地方的PAC信息。KDC会使用subkey，将PAC信息解密并利用我们客户端设定的签名算法验证签名</li>
<li>KDC 验证 (缺少 PAC 的 TGT) 与(不在 TGT 中的 PAC) 这两个成功后，那么会去把 PAC 中的 User SID、Group SID 取出来，重新使用进行签名，签名算法和密钥与设置 inclue-pac 标志位为 TRUE 时一模一样。将新产生的 PAC 加入到解密后的 TGT 中，再重新加密制作全新的 TGT 发送给 Client。(注意这里KDC返回的是一个TGT并不是一个ST)</li>
</ol>
<p>通过以上流程我们成功获得了一个高权限的TGT。</p>
<h2 id="漏洞演示"><a href="#漏洞演示" class="headerlink" title="漏洞演示"></a>漏洞演示</h2><p>攻击机：mac</p>
<p>域控：win2008 172.16.84.35</p>
<p>域内普通用户：test&#x2F;1qaz@WSX</p>
<p>攻击工具： goldenPac &#x20;<br>(这个工具最方便，有py与exe两种。是 ms14-068 与 psexec 的结合，可以直接获得一个shell回来)</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># goldenPac.py</span></span><br><span class="line">python3 goldenPac.py walking.com/test:1qaz@WSX@DC.walking.com -dc-ip 172.16.84.35 -target-ip 172.16.84.35 -debug</span><br><span class="line"></span><br><span class="line"><span class="section"># goldenPac.exe</span></span><br><span class="line">goldenPac.exe walking.com/test:1qaz@WSX@DC.walking.com</span><br></pre></td></tr></table></figure>

<p>运行脚本：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_C01xJRtxUn.png"></p>
<p>成功获得域控的system权限shell：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_I5_CN-awPD.png"></p>
<h1 id="zerologon漏洞分析"><a href="#zerologon漏洞分析" class="headerlink" title="zerologon漏洞分析"></a>zerologon漏洞分析</h1><h2 id="漏洞原因"><a href="#漏洞原因" class="headerlink" title="漏洞原因"></a>漏洞原因</h2><p>windows上比较重量级别的一个漏洞。通过该漏洞，攻击者只需能够访问域控的445端口，在无需任何凭据的情况下能拿到域管的权限。</p>
<p>该漏洞的产生来源于Netlogon协议认证的加密模块存在缺陷（微软在进行AES加密运算过程中，使用了AES-CFB8模式并且错误的将IV设置为全零，这使得攻击者在明文、IV等要素可控的情况下，存在较高概率使得产生的密文为全零。），导致攻击者可以在没有凭证的情况情况下通过认证。</p>
<p>该漏洞的最稳定利用是调用netlogon中RPC函数NetrServerPasswordSet2来重置域控机器的机器用户的密码，从而以域控的身份进行Dcsync获取域管权限。从而接管整个域</p>
<h2 id="DCSync"><a href="#DCSync" class="headerlink" title="DCSync"></a><strong>DCSync</strong></h2><p>在DCSync技术没有出现之前，我们想要dump服务器的hash，一般都要先入侵到目标服务器上，然后使用例如mimikizi的工具，对hash来dump,DCSync的最大特点，在于不用登陆域服务器，即可远程通过域数据同步复制的方式获得想要的用户口令信息。DCSync 就是通过 Directory Replication Service（DRS） 服务的 GetNCChanges 接口向域控发起数据同步请求。</p>
<h2 id="DCSync利用条件"><a href="#DCSync利用条件" class="headerlink" title="DCSync利用条件"></a><strong>DCSync利用条件</strong></h2><p>获得以下任一用户的权限： &#x20;<br>· Administrators组内的用户。 &#x20;<br>· Domain Admins组内的用户。 &#x20;<br>· Enterprise Admins组内的用户。 &#x20;<br>· 域控制器的计算机帐户（机器账户）</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a><strong>漏洞利用</strong></h2><p>第一个参数为目标机器名，第二个为ip</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">工具地址： https://github.com/dirkjanm/CVE-2020-1472</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_FD7nH_kXHX.png"></p>
<p>上一步会把域控DC机器的机器用户的密码置为空，即hash为： &#x20;<br>31d6cfe0d16ae931b73c59d7e0c089c0</p>
<p>接下来使用空密码就可以进行Dcsync(这里不可以直接登录的，因为机器用户是不可以登录的。但是域控的机器用户有Dcsync特权，我们就可以利用该特权来利用Dcsync进行hash读取，然后用读取的hash进行登录或者横向攻击)</p>
<p>下面的工具原理是模仿一个域控制器，从真实的域控制器中请求数据，例如用户的哈希。</p>
<p>利用机器用户及空密码获取域管administrator用户的hash：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 secretsdump.py -no-<span class="keyword">pass</span> de1ay.com/<span class="string">&quot;DC$&quot;</span>@<span class="number">10.10</span><span class="number">.10</span><span class="number">.10</span> -history -just-dc-user administrator</span><br></pre></td></tr></table></figure>

<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">工具地址：https://github.com/SecureAuthCorp/impacket</span><br></pre></td></tr></table></figure>

<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_KsX822KcBh.png"></p>
<p>利用得到的域控用户administrator的账户密码，进行横向登录拿下域控：</p>
<p><img src="/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/image_A5ekCATiBr.png"></p>
<p>拿下域控以后，我们要对我们重置的密码进行恢复，要不然会影响系统业务，这里可以用：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">powershell <span class="built_in">Reset-ComputerMachinePassword</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这是微软官方给的一种解决方案。</p>
<p><strong>（好久之前分析过，有空补一下下面的文章。。。）</strong></p>
<h1 id="Nopac分析"><a href="#Nopac分析" class="headerlink" title="Nopac分析"></a>Nopac分析</h1><h1 id="PrintNightmare分析"><a href="#PrintNightmare分析" class="headerlink" title="PrintNightmare分析"></a>PrintNightmare分析</h1><h1 id="CVE-2025-33073分析"><a href="#CVE-2025-33073分析" class="headerlink" title="CVE-2025-33073分析"></a>CVE-2025-33073分析</h1><h1 id="EXCHANGE"><a href="#EXCHANGE" class="headerlink" title="EXCHANGE"></a>EXCHANGE</h1><p>ProxyShell</p>
<p>ProxyNotSell</p>
<p>ProxyLogon</p>
<p>CVE-2021-26857</p>
<p>PrivExchange</p>
<h1 id="ADCS"><a href="#ADCS" class="headerlink" title="ADCS"></a>ADCS</h1><p><strong>ADCS Relay</strong></p>
<p><strong>ESC系列</strong></p>
<p><strong>CVE-2022-26923</strong></p>
<h1 id="ACL滥用"><a href="#ACL滥用" class="headerlink" title="ACL滥用"></a>ACL滥用</h1><h1 id="委派攻击专项"><a href="#委派攻击专项" class="headerlink" title="委派攻击专项"></a>委派攻击专项</h1><p>非约束委派攻击</p>
<p>约束委派攻击</p>
<p>基于资源的约束委派（RBCD）</p>
<p>Kerberos Bronze Bit</p>
<h1 id="Azure-AD"><a href="#Azure-AD" class="headerlink" title="Azure-AD"></a>Azure-AD</h1><h1 id="Kerberoasting-AS-REP-Roasting"><a href="#Kerberoasting-AS-REP-Roasting" class="headerlink" title="Kerberoasting&#x2F;AS-REP Roasting"></a>Kerberoasting&#x2F;AS-REP Roasting</h1>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text">目录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NTLM%E4%B8%8Ekerberos%E8%AE%A4%E8%AF%81%E4%BD%93%E7%B3%BB"><span class="toc-number">2.</span> <span class="toc-text">NTLM与kerberos认证体系</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E8%AE%A4%E8%AF%81"><span class="toc-number">2.1.</span> <span class="toc-text">本地认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#windows-%E7%BD%91%E7%BB%9C%E8%AE%A4%E8%AF%81"><span class="toc-number">2.2.</span> <span class="toc-text">windows 网络认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM%EF%BC%88NT-LAN-Manager%EF%BC%89%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.3.</span> <span class="toc-text">NTLM（NT LAN Manager）协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM-v1%E4%B8%8ENTLM-v2%E7%9A%84%E5%B7%AE%E5%88%AB"><span class="toc-number">2.4.</span> <span class="toc-text">NTLM v1与NTLM v2的差别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E8%AE%A4%E8%AF%81%E4%BD%93%E7%B3%BB-kerberos%E8%AE%A4%E8%AF%81"><span class="toc-number">2.5.</span> <span class="toc-text">域认证体系-kerberos认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PAC"><span class="toc-number">2.6.</span> <span class="toc-text">PAC</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE%E4%B8%8E%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE%E6%9E%84%E9%80%A0%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">白银票据与黄金票据构造分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE"><span class="toc-number">3.1.</span> <span class="toc-text">白银票据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE"><span class="toc-number">3.2.</span> <span class="toc-text">黄金票据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ticket%E6%80%BB%E7%BB%93"><span class="toc-number">3.3.</span> <span class="toc-text">ticket总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NTLM-smb-%E4%B8%AD%E7%BB%A7%E6%94%BB%E5%87%BB"><span class="toc-number">4.</span> <span class="toc-text">NTLM_smb 中继攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM%E4%B8%AD%E7%BB%A7"><span class="toc-number">4.1.</span> <span class="toc-text">NTLM中继</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#smb%E4%B8%AD%E7%BB%A7"><span class="toc-number">4.2.</span> <span class="toc-text">smb中继</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%94%E7%A4%BA"><span class="toc-number">4.3.</span> <span class="toc-text">演示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MS14-068-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E2%80%94%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84PAC"><span class="toc-number">5.</span> <span class="toc-text">MS14-068 漏洞分析—不安全的PAC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">5.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E5%9B%A0%E7%AE%80%E8%BF%B0"><span class="toc-number">5.2.</span> <span class="toc-text">漏洞原因简述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E5%8E%9F%E5%9B%A0"><span class="toc-number">5.3.</span> <span class="toc-text">详细原因</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%BC%94%E7%A4%BA"><span class="toc-number">5.4.</span> <span class="toc-text">漏洞演示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#zerologon%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">6.</span> <span class="toc-text">zerologon漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E5%9B%A0"><span class="toc-number">6.1.</span> <span class="toc-text">漏洞原因</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DCSync"><span class="toc-number">6.2.</span> <span class="toc-text">DCSync</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DCSync%E5%88%A9%E7%94%A8%E6%9D%A1%E4%BB%B6"><span class="toc-number">6.3.</span> <span class="toc-text">DCSync利用条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">6.4.</span> <span class="toc-text">漏洞利用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Nopac%E5%88%86%E6%9E%90"><span class="toc-number">7.</span> <span class="toc-text">Nopac分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PrintNightmare%E5%88%86%E6%9E%90"><span class="toc-number">8.</span> <span class="toc-text">PrintNightmare分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CVE-2025-33073%E5%88%86%E6%9E%90"><span class="toc-number">9.</span> <span class="toc-text">CVE-2025-33073分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#EXCHANGE"><span class="toc-number">10.</span> <span class="toc-text">EXCHANGE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ADCS"><span class="toc-number">11.</span> <span class="toc-text">ADCS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ACL%E6%BB%A5%E7%94%A8"><span class="toc-number">12.</span> <span class="toc-text">ACL滥用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A7%94%E6%B4%BE%E6%94%BB%E5%87%BB%E4%B8%93%E9%A1%B9"><span class="toc-number">13.</span> <span class="toc-text">委派攻击专项</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Azure-AD"><span class="toc-number">14.</span> <span class="toc-text">Azure-AD</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kerberoasting-AS-REP-Roasting"><span class="toc-number">15.</span> <span class="toc-text">Kerberoasting&#x2F;AS-REP Roasting</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&text=kerberos协议与域内攻击手法分析"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&title=kerberos协议与域内攻击手法分析"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&is_video=false&description=kerberos协议与域内攻击手法分析"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=kerberos协议与域内攻击手法分析&body=Check out this article: http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&title=kerberos协议与域内攻击手法分析"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&title=kerberos协议与域内攻击手法分析"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&title=kerberos协议与域内攻击手法分析"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&title=kerberos协议与域内攻击手法分析"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&name=kerberos协议与域内攻击手法分析&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2022/05/31/kerberos%E5%8D%8F%E8%AE%AE%E4%B8%8E%E5%9F%9F%E5%86%85%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%E5%88%86%E6%9E%90/&t=kerberos协议与域内攻击手法分析"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    wa1ki0g
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
